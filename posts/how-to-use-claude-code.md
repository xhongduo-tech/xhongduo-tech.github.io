## 什么是 Claude Code？

网页版大模型（如 ChatGPT 或 Claude）本质上是受限的对话容器，**缺乏本地项目级上下文，且没有系统执行权限。**

相比之下，Claude Code 是直接部署在本地终端的自动化编程代理（Agent）。它突破了“纯文本交互”的局限，具备全局代码库检索和本地读写/执行权限。当你输入指令（如“修复某函数 bug”），它能自主完成“分析源码 -> 定位缺陷 -> 修改文件 -> 运行测试”的工程闭环。凭借查阅文档和并发调度多个子代理（Sub-agents）的能力，它将 AI 的角色从单纯的“代码片段生成器”升级为了可以直接在本地环境交付结果的自动化执行引擎。

---

## 安装与配置

### 第一步：安装 Claude Code

打开终端，粘贴以下命令并回车：

**macOS / Linux / WSL（Windows 子系统）：**

```bash
curl -fsSL https://claude.ai/install.sh | bash
```

**Windows PowerShell：**

```bash
irm https://claude.ai/install.ps1 | iex
```

这条命令会自动帮你安装好所有依赖。安装完成后，验证一下：

```bash
claude --version
claude doctor
```

`claude doctor` 会检查你的安装是否健康，有问题会直接告诉你怎么修复。

### 第二步：登录账号

你需要一个 Anthropic 账号（Claude Pro、Max、Teams 或 Enterprise 均可）。直接运行：

```bash
claude
```

首次启动会引导你在浏览器里完成登录授权。授权完成后回到终端，就可以开始了。

**没有 Anthropic 账号？想用国内模型？**

以火山引擎 ARK 平台为例（支持接入多种模型），无需搭建代理，修改两个配置文件即可：

**第一步**：编辑 `~/.claude/settings.json`（Windows：`C:\Users\<用户名>\.claude\settings.json`），填入平台 API Key 和模型名称：

```json
{
  "env": {
    "ANTHROPIC_AUTH_TOKEN": "<ARK_API_KEY>",
    "ANTHROPIC_BASE_URL": "https://ark.cn-beijing.volces.com/api/coding",
    "ANTHROPIC_MODEL": "<Model_Name>"
  }
}
```

**第二步**：编辑 `~/.claude.json`（Windows：`C:\Users\<用户名>\.claude.json`），将 `hasCompletedOnboarding` 设为 `true`，跳过首次登录引导：

```json
{
  "hasCompletedOnboarding": true
}
```

保存后重新打开终端，运行 `claude` 即可。

> 注意：不同平台对 Claude Code 工具调用格式的支持程度不一，实际体验可能与官方模型有差距。

---

## 第一次对话：它到底能做什么

进入你的项目目录，启动 Claude Code：

```bash
cd your-project
claude
```

你会看到一个 `>` 提示符，这就是你和 Claude 的对话框。

直接用中文告诉它你想做什么：

```text
> 帮我看看 src/auth.js 这个文件，有没有什么安全隐患？
```

Claude 会打开文件、阅读内容、给出分析。你不需要把代码复制粘贴给它——它直接读你的文件。

Claude Code 能做的事情非常多：

| 任务类型 | 示例 |
|---------|------|
| **修复 Bug** | "登录时偶尔会报 undefined，帮我找找原因" |
| **开发新功能** | "给用户设置页加一个头像上传功能" |
| **重构代码** | "这个文件太长了，帮我拆成几个模块，逻辑不变" |
| **理解代码库** | "这个项目的认证流程是怎么运作的？画一个流程图" |
| **写测试** | "给 utils/format.js 里的函数写单元测试，用 Jest" |
| **代码审查** | "帮我 review 一下最近这次提交的改动" |
| **Git 操作** | "帮我写一个语义化的 commit message 然后提交" |
| **查文档** | "React 19 的新特性是什么？帮我评估影响" |
| **框架迁移** | "把状态管理从 Redux 迁移到 Zustand，保持行为一致" |
| **安全审计** | "扫一下整个项目，找出所有可能的 SQL 注入和 XSS 风险" |
| **生成文档** | "给 src/api/ 下所有接口生成 JSDoc 注释" |
| **环境排查** | "本地跑不起来，帮我诊断是哪里的配置问题" |

---

## 核心交互技巧

### 说清楚约束，比说清楚目标更重要

新手常犯的错误：把目标描述得很详细，但没说清楚边界。

```text
# 模糊
> 优化一下数据库查询

# 清晰
> 优化 src/db/users.js 里的 getUsersByAge 函数的查询性能，
  不要改变返回值的数据结构，改完跑一下现有的测试确保没有破坏
```

约束越清晰，Claude 越不会"发挥过度"——改了你不想改的东西。

### 先让它解释计划，再让它动手

对于涉及多个文件的复杂改动，先问计划：

```text
> 我想把整个项目的用户认证从 JWT 改成 Session，
  先告诉我你打算怎么改，改哪些文件，我确认了再动手
```

Claude 会给你一份改动计划，你确认无误后再说"好，开始吧"。这是避免意外改动的最有效方式。

### 用 `@` 精准引用文件

```text
> @src/components/Header.tsx 和 @src/styles/global.css 看一下，
  现在 header 的样式为什么在移动端会溢出？
```

`@文件路径` 让 Claude 直接关注你指定的文件，不需要它自己去猜。

### 用 `!` 直接跑命令

在 `>` 后面加 `!` 可以直接执行 shell 命令，不经过 Claude 处理：

```bash
!npm test
!git log --oneline -10
!ls src/
```

适合在和 Claude 对话过程中快速查看命令输出。

---

## 常用命令速查

Claude Code 有一套斜杠命令（Slash Commands），在 `>` 提示符后输入 `/` 开头的指令：

| 命令 | 作用 | 典型使用场景 |
|-----|------|------------|
| `/help` | 查看所有可用命令 | 忘记命令名称时 |
| `/clear` | 清除对话历史 | 切换到完全不相关的新任务前 |
| `/compact` | 压缩上下文，节省 token | 对话过长、Claude 开始"忘事"时 |
| `/model` | 切换 AI 模型（Sonnet / Opus / Haiku）| 需要更强推理（切 Opus）或降低成本（切 Haiku）时 |
| `/init` | 为当前项目生成 CLAUDE.md 记忆文件 | 第一次在一个新项目里使用 Claude Code 时 |
| `/memory` | 编辑 Claude 的记忆文件 | 需要手动追加或修正项目约定时 |
| `/permissions` | 查看和修改工具权限 | Claude 因权限不足无法执行某些操作时 |
| `/mcp` | 管理 MCP 外部服务连接 | 需要接入 GitHub、数据库、Jira 等外部工具时 |
| `/status` | 查看当前版本、模型、账号信息 | 确认当前用的模型或登录状态时 |
| `/cost` | 查看本次会话的 token 消耗和费用 | 不确定当前会话花了多少钱时 |
| `/context` | 可视化查看上下文使用量 | 感觉上下文快满、准备执行 /compact 前 |
| `/rewind` | 撤销最近的代码改动，回到上一个状态 | Claude 改了不该改的东西，需要回退时 |
| `/vim` | 开启 vim 键位编辑模式 | 习惯 vim 操作的用户 |

**键盘快捷键：**

| 快捷键 | 作用 | 典型使用场景 |
|-------|------|------------|
| `Ctrl+C` | 中断当前生成 | Claude 回答走偏、生成太慢想重来时 |
| `Ctrl+L` | 清屏（保留对话历史）| 屏幕输出太多，想清爽一下 |
| `Ctrl+O` | 切换详细模式（查看 Claude 调用了哪些工具、读了哪些文件）| 想了解 Claude 实际在做什么，或排查行为异常时 |
| `Ctrl+R` | 搜索历史命令 | 想复用之前输入过的指令时 |
| `Shift+Tab` | 循环切换权限模式（计划模式 / 自动执行 / 普通模式）| 需要在只读探索和自动执行之间切换时 |
| `Option+T`（macOS）| 切换深度思考模式 | 遇到复杂问题，想让 Claude 花更多时间推理时 |
| `Esc+Esc` | 撤销并重来 | 发现消息发错了，想修改再重新发送时 |

---

## 高阶策略一：激活深度思考

Claude Code 有一个"深度思考"模式。开启后，模型会在回答之前进行大量的内部推理——这个过程你看不见，但结果明显更深入，尤其适合处理复杂问题。

### 如何开启

**方法一：快捷键切换（推荐）**

按 `Option+T`（macOS）或 `Alt+T`（Windows/Linux）可以在当前会话里切换深度思考的开关状态。

**方法二：切换到 Opus 模型并设置思考强度**

```text
> /model
```

选择 `claude-opus-4-6`，然后可以设置思考强度（low / medium / high）。Opus 配合 high 强度是目前最强的推理组合。

**方法三：用 `Ctrl+O` 查看思考过程**

开启详细模式后，你可以看到 Claude 的内部推理以灰色斜体显示。这不仅帮你理解它的决策逻辑，也让你能及早发现它是否走偏了。

### 什么时候用深度思考？

并非所有任务都需要深度思考。它最有价值的场景：

- **架构决策**："我们的系统目前每秒处理 1 万个请求，未来要扩展到 100 万，现有架构的瓶颈在哪里，怎么改"
- **复杂 Bug 排查**：表面现象和根本原因之间有很长的推理链
- **技术方案对比**：需要权衡多个方案的优劣，考虑长期影响
- **数学或算法问题**：需要严格推导的场景

对于简单的"帮我改个变量名"或"解释一下这行代码"，不需要深度思考，普通模式更快更省。

---

## 高阶策略二：召唤多智能体团队

这是 Claude Code 最令人兴奋的能力之一，也是最容易被忽视的。

### 什么是多智能体？

当你给 Claude 一个庞大的任务时，它默认在单个上下文窗口里完成所有工作。多智能体（Agent Teams / Subagents）允许 Claude 将任务**拆分成并行的子任务**，由多个独立的 AI 实例同时处理，主 Claude 负责协调和汇总。

类比：这就像一个项目经理把工作分配给不同的团队成员，而不是一个人从头做到尾。

### 使用方法：直接告诉它

Claude Code 会根据你的指令自动决定是否需要子代理。你只需要在提示词中暗示并行工作的需求：

```text
> 这个应用有一个性能问题，页面加载很慢。
  请从两个方向同时排查：
  1. 前端这边，检查是否有不必要的重渲染和大体积资源
  2. 后端这边，检查 API 响应时间和数据库查询是否有慢查询
  两边同时查，最后给我一个汇总报告
```

Claude 会并行启动子代理分别处理，然后汇总结果。你获得的是两条调查路径的结果，时间却接近只查一条路径。

### 更强大的团队协作场景

```text
> 我需要给这个项目写完整的测试覆盖。
  请组建一个团队：
  - 一个负责给所有 utils 函数写单元测试
  - 一个负责给 API 路由写集成测试
  - 一个负责给 React 组件写 snapshot 测试
  三个方向并行进行
```

```text
> 准备发版前的代码审查。
  请同时从三个角度审查最近的改动：
  - 安全性：有没有注入漏洞、权限问题
  - 性能：有没有 N+1 查询、内存泄漏
  - 代码质量：有没有重复逻辑、命名不清晰
```

### 启用实验性 Agent Teams

上述的子代理是内置行为。如果想启用更强大的**实验性多智能体团队**（每个智能体有独立上下文窗口、可以互相直接通信），需要先开启：

> **注意**：这是实验性功能，API 可能随版本变化。以下配置适用于撰文时的版本，请以[官方文档](https://docs.anthropic.com/claude/claude-code)为准。

在 `~/.claude/settings.json` 里添加：

```json
{
  "env": {
    "CLAUDE_CODE_EXPERIMENTAL_AGENT_TEAMS": "1"
  }
}
```

然后可以使用 `--teammate-mode` 标志启动：

```bash
claude --teammate-mode in-process
```

---

## 高阶策略三：深度研究模式

Claude Code 有一个专门用于**深度探索代码库**的子代理类型，叫做 **Explore 代理**。当你需要全面理解一个陌生代码库，或者深入调查一个复杂问题时，让 Claude 使用这种模式。

### 使用方式

直接在提示词里表达"我需要全面了解"的意图：

```text
> 我刚接手这个项目，完全不了解它的结构。
  请帮我全面探索：数据流是怎样的，核心模块有哪些，
  各模块之间的依赖关系是什么，写一份架构摘要给我
```

```text
> 这个 bug 报告说用户在高并发情况下会看到脏数据。
  请深入研究整个数据层：数据库访问模式、缓存策略、
  事务处理，找出所有可能导致竞态条件的地方
```

### 结合网络搜索做技术研究

Claude Code 可以结合网络搜索做技术方案调研：

```text
> 我们需要给 API 加限流功能。
  请研究目前主流的限流算法（令牌桶、漏桶、滑动窗口等），
  结合我们当前的 Redis 使用情况，给出一个具体的实现方案建议
```

Claude 会读你的代码、搜索最新文档、综合给出针对你项目的具体建议——不是泛泛而谈，而是"你的 `src/middleware/` 目录下可以这样加"。

### 让 Claude 先研究，再行动

对于任何重要的改动，这个工作流最稳：

```bash
# 第一步：只读研究
> 研究一下把我们的状态管理从 Redux 迁移到 Zustand 的可行性，
  分析改动范围，不要做任何修改

# 第二步（确认后）：制定计划
> 好，根据你的分析，制定一个分阶段的迁移计划

# 第三步（计划确认后）：执行
> 开始执行第一阶段
```

---

## CLAUDE.md：让 Claude 记住你的习惯

每次启动新会话，Claude Code 都会重新读取项目根目录下的 **CLAUDE.md** 文件。这个文件就是 Claude 的"项目说明书"——你在里面写的任何约定，它都会在每次对话中遵守。

### 生成第一个 CLAUDE.md

在项目目录里运行：

```bash
> /init
```

Claude 会扫描你的项目（package.json、配置文件、代码结构），自动生成一份 CLAUDE.md 草稿。你再根据实际情况调整。

### CLAUDE.md 应该写什么

```markdown
# 项目说明

## 技术栈
- 前端：React 19 + TypeScript，用 Vite 构建
- 后端：Node.js + Fastify
- 数据库：PostgreSQL，ORM 用 Drizzle
- 测试：Vitest + Testing Library

## 常用命令
- 开发：`npm run dev`
- 测试：`npm test`
- 类型检查：`npm run typecheck`
- 构建：`npm run build`

## 代码规范
- 使用 ES Modules（import/export），不用 CommonJS
- 所有新组件用函数组件 + Hooks，不用 Class 组件
- 变量命名用 camelCase，组件用 PascalCase
- 每个功能改动后必须跑一遍测试

## 注意事项
- 不要修改 src/legacy/ 目录下的文件，这是历史遗留代码
- API 接口的返回值结构不要改，有下游依赖
- 数据库迁移文件一旦提交就不能修改，要回滚请新建迁移
```

**写什么，不写什么？**

| 应该写 | 不应该写 |
|--------|---------|
| Claude 猜不到的特殊命令 | Claude 已知的通用约定（比如"用英文注释"）|
| 你项目特有的规范 | 详细的 API 文档（链接就够了）|
| 禁止改动的区域 | 变化频繁的内容 |
| 架构决策的原因 | 显而易见的内容 |

CLAUDE.md 过长会被忽略，保持简洁。定期清理过时的内容。

### 多层级记忆

| 文件位置 | 生效范围 | 是否提交 Git |
|---------|---------|------------|
| `./CLAUDE.md` | 当前项目（团队共享）| 提交 |
| `./CLAUDE.local.md` | 当前项目（个人）| 不提交（自动忽略）|
| `~/.claude/CLAUDE.md` | 所有项目（全局）| — |

个人偏好（比如"永远不要自动提交代码，先让我确认"）放 `CLAUDE.local.md` 或全局文件，不要污染团队共享的 `CLAUDE.md`。

---

## 实战工作流示例

### 场景一：接手陌生项目，快速上手

```bash
cd unknown-project
claude

> /init
> 帮我读懂这个项目：它是干什么的，核心流程是什么，
  主要模块有哪些，我应该从哪里开始读代码？
> 这个项目怎么跑起来？有什么需要特别注意的配置？
```

**5 分钟内**，你会对一个陌生项目有清晰的认知，而不是茫然地翻文件。

### 场景二：从报错到修复的完整流程

```bash
> 我在运行 npm test 时看到这个错误：
  [粘贴完整的报错信息]
  帮我找出根本原因，不是只修复表面症状
```

> 找到根本原因后，在修复前先告诉我你打算怎么改，我确认一下

> 好，开始修复。改完再跑一遍测试确认没有引入新问题

### 场景三：功能开发标准流程

```bash
> 需求：给用户列表页加一个按注册日期范围筛选的功能。
  先分析一下现有的筛选逻辑在哪里，搞清楚后给我一个改动计划

（确认计划）

> 开始实现。注意：
  - 筛选逻辑放在 src/hooks/useUserFilter.ts
  - 日期选择器用已有的 DateRangePicker 组件
  - 改完写对应的单元测试

（实现完成）

> 帮我写一个 git commit message，描述刚才所有的改动
```

### 场景四：代码审查与重构

```bash
> 帮我 review 最近这次提交（git log 看一下），
  重点关注：1）有没有 SQL 注入风险，2）有没有未处理的边界情况，
  3）有没有可以简化的逻辑，给出具体的改进建议

> 你提到的第 2 点，帮我修复，其他建议我自己来
```

---

## 进阶技巧

### 用 `-p` 做一次性任务

不需要交互式会话时，用 `-p`（`--print`）模式：

```bash
# 快速解释一个文件
claude -p "解释一下 src/auth.js 的实现逻辑"

# 结合管道
cat error.log | claude -p "分析这个错误日志，找出最高频的问题"

# 集成到 CI 脚本
git diff main | claude -p "生成一份这次改动的中文变更说明"
```

### 用 `--verbose` 理解 Claude 的行动

```bash
claude --verbose
```

详细模式下，你会看到 Claude 每一步的工具调用——它打开了哪个文件、跑了什么命令、搜索了什么内容。这在调试"Claude 为什么做了这个决定"时非常有用，也是学习如何更好地使用它的最快方式。

### 跨项目工作时的上下文管理

```bash
# 使用 worktree 在独立的 git 工作树里处理新分支
claude -w feature-auth

# 不同任务之间记得清理上下文
> /clear

# 长会话里定期压缩
> /compact 专注于认证模块的问题，其他部分不重要
```

### 用模型切换控制成本

```text
> /model haiku   # 简单任务，最快最省
> /model sonnet  # 日常编码，平衡性能与成本（默认）
> /model opus    # 复杂架构决策，最强但最贵
```

根据任务复杂度切换，不需要所有任务都用最强的模型。

### 给 Claude 设置"护栏"

对于可能造成破坏的操作（删除文件、推送代码等），可以设置权限：

```bash
# 进入计划模式：只读，不执行任何改动
claude --permission-mode plan

# 或在对话中按 Shift+Tab 切换模式
```

计划模式下，Claude 只会分析和建议，不会实际修改任何东西——适合探索阶段。

---

## 新手常见问题

**Q：Claude 改了我不想改的东西怎么办？**

用 `/rewind` 撤销最近的改动。或者按 `Esc` 中断正在进行的操作。如果已经保存，用 `git checkout` 回滚。

**Q：对话太长，感觉 Claude 开始"忘事"怎么办？**

这是上下文窗口接近上限的表现。运行 `/compact` 压缩历史，或 `/clear` 开启新会话。经常清理上下文，每个不相关的任务都应该用 `/clear` 分隔。

**Q：不放心 Claude 直接改文件，怎么更安全地使用？**

1. 重要改动前用 `/plan` 或 `--permission-mode plan` 先看计划
2. 工作在独立的 git 分支上（用 `-w` 创建 worktree）
3. 改完之后看 `git diff` 确认再提交

**Q：怎么知道每次对话花了多少 token / 钱？**

```text
> /cost
```

实时查看本次会话的 token 消耗和估算费用。

---

## 总结

Claude Code 的使用有一条很清晰的进阶曲线：

```text
第一周   → 用它读代码、解释报错、修小 bug
第二周   → 开始告诉它约束，先计划再动手
第一个月 → 写好 CLAUDE.md，深度思考处理复杂问题
往后     → 多智能体并行、自动化流水线、构建自己的工作流
```

最重要的一个心态转变：**不要把它当工具，把它当队友**。和队友协作，你需要说清楚背景、约束和期望；你需要在关键节点确认方向；你需要在它走偏时及时纠正。做到这些，Claude Code 能真正成倍地放大你的生产力。

---

*相关资源*

- 官方文档：[code.claude.com](https://code.claude.com)
- Claude Code 更新日志：[anthropic.com/changelog](https://www.anthropic.com/changelog)
